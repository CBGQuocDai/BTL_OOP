<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/43.1.0/ckeditor5.css" />
        <script src="https://cdn.ckeditor.com/ckeditor5/43.1.0/ckeditor5.umd.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
              integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
              crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
              integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous" />
        <link rel="stylesheet" th:href="@{/css/profile_post.css}" />
        <title>Profile User</title>
        <style>
            .inner-main {
                width: 100%;
                overflow: hidden;
                .row{
                    width: 100%;
                }
            }
        </style>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
        <script>
            var stompClient = null;
            function connect() {
                var socket = new SockJS('/gs-guide-websocket');
                stompClient = Stomp.over(socket);
                stompClient.connect({}, function (frame) {
                    stompClient.subscribe('/topic/notifications', function (notification) {
                        showNotification(JSON.parse(notification.body));
                    });
                });
            }
            function showNotification(notice) {
                let check= [[${userId}]];
                const notification= document.getElementById('notification');
                console.log(check,notice['userId'], check === notice['userId'])

                if( check === notice['userId']) {
                    notification.src='../file/notification2.png';
                }
            }
            window.onload = function() {
                connect();
            };
        </script>
    </head>

    <body>
    <div class="header">
        <ul>
            <li><img style="width: 70px" th:src="@{../file/logo.png}" alt=""></li>
            <li><a href="/post/latest"><h2>Post</h2></a></li>
            <li><a href="/question/latest"><h2>Question</h2></a></li>
        </ul>
        <ul class="right">
            <li>
                <form action="/search" method="get" class="find">
                    <input id="search" type="text" name="keyword" placeholder="Search in FoxGraphy" required>
                    <img th:src="@{../file/searchIcon.png}" alt="">
                </form>
            </li>
            <li><a th:href="'/notifications/'+${userId}"><img class="icon" id="notification" th:src="@{../file/notificationIcon.png}" alt=""></a></li>
            <li><a href="/create"><img class="icon"  th:src="@{../file/writeBlog.png}" alt=""></a></li>
            <li><a href="/My_Profile/userInfo"><img class="icon" id="avatar" th:src="@{${avatarUser}}" alt=""></a></li>
        </ul>

    </div>

        <div class="inner-main">
            <div class="row">
                <div class="col-3">
                    <div class="inner-sidebar">
                        <ul>
                            <li class="mt-1"></li>
                            <li class="">
                                <a class="" href="/My_Profile/userInfo">
                                    <i class="fa-regular fa-user"></i>
                                    <span>userInfo</span>
                                </a>
                            </li>
                            <li>
                                <a href="/My_Profile/ChangePassword">
                                    <i class="fa-solid fa-lock"></i>
                                    <span>Change password</span>
                                </a>
                            </li>
                            <li class="active">
                                <a href="/My_Profile/post">
                                    <i class="fa-solid fa-address-card"></i>
                                    <span>Post</span>
                                </a>
                            </li>
                            <li>
                                <a href="/My_Profile/question">
                                    <i class="fa-regular fa-circle-question"></i>
                                    <span>Question</span>
                                </a>
                            </li>
                            <li>
                                <a href="/login">
                                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                                    <span>Logout</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-9">
                    <div class="inner-content">
                        <div th:each="post : ${posts}" class="inner-box d-flex p-4">
                            <div class="inner-avatar mr-2 mt-3">
                                <img src="" alt="" />
                            </div>
                            <div class="inner-content">
                                <div class="inner-head mb-2">
                                    <span th:text="${post.time}" class="mr-3">23/09/2024 - 20:30</span>
                                </div>
                                <div class="inner-mid mb-2">
                                    <div th:utext="${post.title}" class="inner-desc font-weight-bold mb-1">
                                        Comparable và Comparator trong Java: Bạn
                                        nên lựa chọn cái nào?
                                    </div>
                          
                                        <div th:each="tag:${post.tags.split(',')}" th:text="${tag}" class="btn btn-secondary btn-sm py-1">
                                            Java
                                        </div>
                          
                                </div>
                                <div class="inner-foot d-flex">
                                    <i class="fa-solid fa-caret-up mr-3" > <span style="margin-right: 7px" th:text="${post.countVote}">90</span></i>
                                    <i class="fa-regular fa-bookmark mr-3"><span style="margin-left:7px" th:text="${post.countBookmark}">90</span></i>
                                    <i class="fa-regular fa-message"><span style="margin-left:7px" th:text="${post.countComment}">90</span></i>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- bs4 -->
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
                integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
        <script>
            const notification= document.getElementById('notification');
            notification.addEventListener('click',(event) => {
                notification.src="/file/notificationIcon.png";
            });
        </script>
        <script>
            const search = document.getElementById("search");
            search.addEventListener('keydown', (event) =>{
                if(event.key=== "Enter"){
                    let keyword =search.value;
                    if(keyword) {
                        fetch(`/search?keyword=${encodeURIComponent(keyword)}`)
                    }
                }
            })
        </script>
    </body>

</html>